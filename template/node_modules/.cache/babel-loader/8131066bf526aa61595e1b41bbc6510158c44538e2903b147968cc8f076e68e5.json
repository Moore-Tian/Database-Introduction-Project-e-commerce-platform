{"ast":null,"code":"import axios from 'axios';\nimport store from \"../store\";\nimport { API_BASE_PATH } from \"@/config\";\nimport qs from 'qs';\naxios.defaults.withCredentials = true;\nconst request = axios.create({\n  baseURL: API_BASE_PATH // url = base url + request url\n  // send cookies when cross-domain requests\n  // timeout: 5000 // request timeout\n});\n\n/**\n * 请求带上token\n */\nrequest.interceptors.request.use(function (config) {\n  config.headers = {\n    ...(store.state.user.token ? {\n      Authorization: 'Bearer ' + store.state.user.token\n    } : {}),\n    ...(config.headers || {})\n  };\n  if (config.method === 'get') {\n    config.paramsSerializer = function (params) {\n      return qs.stringify(params, {\n        arrayFormat: 'repeat'\n      });\n    };\n  }\n  return config;\n}, function (err) {\n  return Promise.reject(err);\n});\n\n/**\n * 处理响应\n */\nrequest.interceptors.response.use(function (res) {\n  //如果是下载文件，则直接返回\n  if (res.request.responseType === 'blob') {\n    return res;\n  }\n  if (res.data.code !== 0) {\n    return Promise.reject(res.data);\n  }\n  return res.data.data;\n}, function (err) {\n  return Promise.reject(err);\n});\nexport default request;\nexport const download = (url, filename = '') => {\n  request.get(`${url}?fileName=${filename}`, {\n    responseType: 'blob'\n  }).then(response => {\n    const blob = new Blob([response.data]);\n    const tempLink = document.createElement('a'); // 创建a标签\n    const href = window.URL.createObjectURL(blob); // 创建下载的链接\n    //filename\n    const fileName = decodeURI(response.headers['content-disposition'].split('filename=')[1]);\n    tempLink.href = href;\n    tempLink.target = \"_blank\";\n    tempLink.download = fileName;\n    document.body.appendChild(tempLink);\n    tempLink.click(); // 点击下载\n    document.body.removeChild(tempLink); // 下载完成移除元素\n    window.URL.revokeObjectURL(href); // 释放掉blob对象\n  });\n};","map":{"version":3,"names":["axios","store","API_BASE_PATH","qs","defaults","withCredentials","request","create","baseURL","interceptors","use","config","headers","state","user","token","Authorization","method","paramsSerializer","params","stringify","arrayFormat","err","Promise","reject","response","res","responseType","data","code","download","url","filename","get","then","blob","Blob","tempLink","document","createElement","href","window","URL","createObjectURL","fileName","decodeURI","split","target","body","appendChild","click","removeChild","revokeObjectURL"],"sources":["C:/Users/lenovo/Desktop/File/数据库引论/Shopping-Center-master/template/src/utils/request.js"],"sourcesContent":["import axios from 'axios'\nimport store from \"../store\";\nimport {API_BASE_PATH} from \"@/config\";\nimport qs from 'qs';\n\naxios.defaults.withCredentials = true;\nconst request = axios.create({\n    baseURL: API_BASE_PATH, // url = base url + request url\n    // send cookies when cross-domain requests\n    // timeout: 5000 // request timeout\n});\n\n/**\n * 请求带上token\n */\nrequest.interceptors.request.use(function (config) {\n    config.headers = {\n        ...(store.state.user.token ? {Authorization: 'Bearer ' + store.state.user.token} : {}),\n        ...(config.headers || {})\n    };\n    if (config.method === 'get') {\n        config.paramsSerializer = function (params) {\n            return qs.stringify(params, {arrayFormat: 'repeat'})\n        }\n    }\n    return config\n}, function (err) {\n    return Promise.reject(err)\n});\n\n/**\n * 处理响应\n */\nrequest.interceptors.response.use(function (res) {\n    //如果是下载文件，则直接返回\n    if (res.request.responseType === 'blob') {\n        return res;\n    }\n    if (res.data.code !== 0) {\n        return Promise.reject(res.data)\n    }\n    return res.data.data\n}, function (err) {\n    return Promise.reject(err)\n});\n\nexport default request;\n\nexport const download = (url, filename = '') => {\n    request.get(`${url}?fileName=${filename}`, {responseType: 'blob'}).then(response => {\n        const blob = new Blob([response.data]);\n        const tempLink = document.createElement('a');     // 创建a标签\n        const href = window.URL.createObjectURL(blob);       // 创建下载的链接\n        //filename\n        const fileName = decodeURI(response.headers['content-disposition'].split('filename=')[1]);\n        tempLink.href = href;\n        tempLink.target = \"_blank\";\n        tempLink.download = fileName;\n        document.body.appendChild(tempLink);\n        tempLink.click();     // 点击下载\n        document.body.removeChild(tempLink); // 下载完成移除元素\n        window.URL.revokeObjectURL(href) // 释放掉blob对象\n    })\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}