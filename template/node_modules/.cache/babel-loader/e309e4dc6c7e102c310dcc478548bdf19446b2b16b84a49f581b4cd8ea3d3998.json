{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { required } from \"@/utils/widget\";\nexport default {\n  name: \"business_add_commodity\",\n  data() {\n    return {\n      id: parseInt(this.$route.params.id),\n      productForm: {\n        product_name: \"\",\n        // 商品名\n        product_color: \"\",\n        // 商品颜色\n        // TODO：商品进价/商品售价\n        product_brand: \"\",\n        // 商品库存\n        product_cost: \"\",\n        // 商品库存\n        product_image1: \"\",\n        // 主页图片\n        product_image2: \"\"\n        // TODO：细节图片\n      },\n\n      showPic1: \"\",\n      showPic2: \"\",\n      formEmptyRule: [required(\"此栏目\")],\n      costRule: [required(\"此栏目\"), function (v) {\n        return /^(([1-9]{1}\\d*)|(0{1}))(\\.\\d{1,2})?$/.test(v) || `金额最多两位小数`;\n      }]\n    };\n  },\n  async created() {\n    await this.fetchInfoToForm();\n  },\n  methods: {\n    async fetchInfoToForm() {\n      await this.axios.get('fetch_product/', {\n        params: {\n          product_id: this.id\n        }\n      }).then(response => {\n        console.log(response);\n        this.productForm = {\n          product_name: response.data.product.fields.product_name,\n          // 商品名\n          product_color: response.data.product.fields.product_color,\n          // 商品颜色\n\n          product_brand: response.data.product.fields.product_brand,\n          // 商品库存\n          product_cost: response.data.product.fields.product_cost,\n          // 商品库存\n          product_image1: null,\n          // 主页图片\n          product_image2: null\n        };\n        this.showPic2 = 'http://127.0.0.1:8000/media/' + response.data.product.fields.product_imageDetail;\n        this.showPic1 = 'http://127.0.0.1:8000/media/' + response.data.product.fields.product_image;\n      }).catch(function (error) {\n        console.log(error);\n      });\n    },\n    // TODO：保存商品信息\n    async saveProduct() {\n      let formData = new FormData();\n      formData.append('product_image1', this.productForm.product_image1);\n      formData.append('product_image2', this.productForm.product_image2);\n      const json = JSON.stringify(this.productForm);\n      const blob = new Blob([json], {\n        type: 'application/json'\n      });\n      formData.append('forms', blob);\n      const json2 = JSON.stringify(this.$store.state.userId);\n      const blob2 = new Blob([json2], {\n        type: 'application/json'\n      });\n      formData.append('user_id', blob2);\n      const json3 = JSON.stringify(this.id);\n      const blob3 = new Blob([json3], {\n        type: 'application/json'\n      });\n      formData.append('product_id', blob3);\n      console.log(\"blob2\");\n      console.log(blob2);\n      console.log(JSON.stringify(this.$store.state.user_id));\n      var configs = {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      };\n      await this.axios.post('edit_product/', formData, configs).then(response => {\n        console.log(formData.get('forms'));\n        if (response.data.msg === \"success\") {\n          //this.showPic1 = 'http://127.0.0.1:8000/media/'+response.data.image1\n          //this.showPic2 = 'http://127.0.0.1:8000/media/'+response.data.image2\n          console.log(response);\n          window.alert(\"商品修改申请已成功提交，请耐心等待审核通过\");\n          this.$router.push({\n            path: '/business/commodity'\n          });\n        }\n        console.log(response);\n      }).catch(function (error) {\n        console.log(error);\n      });\n    },\n    getImageFile1: function (e) {\n      this.productForm.product_image1 = e.target.files[0];\n      let img = new FileReader();\n      img.readAsDataURL(this.productForm.product_image1);\n      console.log(\"img:\", img);\n      img.onload = ({\n        target\n      }) => {\n        this.showPic1 = target.result; //将img转化为二进制数据\n        console.log(\"target:\", target);\n      };\n    },\n    getImageFile2: function (e) {\n      this.productForm.product_image2 = e.target.files[0];\n      let img = new FileReader();\n      img.readAsDataURL(this.productForm.product_image2);\n      console.log(\"img:\", img);\n      img.onload = ({\n        target\n      }) => {\n        this.showPic2 = target.result; //将img转化为二进制数据\n        console.log(\"target:\", target);\n      };\n    },\n    async onSubmit() {\n      console.log(\"good\");\n    },\n    clear() {\n      this.productForm = {\n        product_name: \"\",\n        // 商品名\n        product_color: \"\",\n        // 商品颜色\n        // TODO：商品进价/商品售价\n        product_brand: \"\",\n        // 商品库存\n        product_cost: \"\",\n        // 商品库存\n        product_image1: \"\",\n        // 主页图片\n        product_image2: \"\"\n        // TODO：细节图片\n      }, this.showPic1 = \"\", this.showPic2 = \"\";\n    }\n  }\n};","map":{"version":3,"mappings":";AAqHA;AAEA;EACAA;EACAC;IACA;MACAC;MAEAC;QACAC;QAAA;QACAC;QAAA;QACA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QACA;MACA;;MACAC;MACAC;MACAC;MACAC,4BACA;QACA;MACA;IAGA;EACA;EACA;IACA;EACA;EAIAC;IACA;MACA;QAAAC;UAAAC;QAAA;MAAA,GACAC;QACAC;QACA;UACAd;UAAA;UACAC;UAAA;;UAEAC;UAAA;UACAC;UAAA;UACAC;UAAA;UACAC;QAEA;QACA;QACA;MAEA,GACAU;QACAD;MAEA;IACA;IACA;IACA;MACA;MACAE;MACAA;MAEA;MACA;QACAC;MACA;MAEAD;MAEA;MACA;QACAC;MACA;MAEAD;MAEA;MACA;QACAC;MACA;MAEAD;MAGAF;MACAA;MACAA;MAEA;QACAI;UAAA;QAAA;MACA;MAEA;QACAJ;QACA;UACA;UACA;UACAA;UAMAK;UACA;YAAAC;UAAA;QAGA;QACAN;MACA,GACAC;QACAD;MACA;IAEA;IACAO;MACA;MACA;MACAC;MACAR;MACAQ;QAAAC;MAAA;QACA;QACAT;MACA;IACA;IACAU;MACA;MACA;MACAF;MACAR;MACAQ;QAAAC;MAAA;QACA;QACAT;MACA;IACA;IACA;MACAA;IACA;IACAW;MACA;QACAzB;QAAA;QACAC;QAAA;QACA;QACAC;QAAA;QACAC;QAAA;QACAC;QAAA;QACAC;QACA;MACA,GACA,oBACA;IACA;EACA;AACA","names":["name","data","id","productForm","product_name","product_color","product_brand","product_cost","product_image1","product_image2","showPic1","showPic2","formEmptyRule","costRule","methods","params","product_id","then","console","catch","formData","type","headers","window","path","getImageFile1","img","target","getImageFile2","clear"],"sourceRoot":"src/view/business","sources":["business_edit_commodity.vue"],"sourcesContent":["<template>\r\n  <div class=\"py-2 px-2 height-100pc user-center\" elevation=\"1\">\r\n    <v-row no-gutters justify=\"space-between\">\r\n      <v-col class=\"ml-3\">\r\n        <v-toolbar\r\n            dark\r\n            color=\"blue darken-3\"\r\n            class=\"mb-1\"\r\n        >\r\n          <v-spacer></v-spacer>\r\n          <v-toolbar-title>\r\n            <h4>添加商品</h4>\r\n          </v-toolbar-title>\r\n          <v-spacer></v-spacer>\r\n        </v-toolbar>\r\n        <v-card>\r\n          <v-card flat class=\"pa-3\">\r\n            <v-row>\r\n              <v-col md=\"6\">\r\n                <v-form ref=\"form\">\r\n                  <!-- 字段渲染 -->\r\n                  <v-container>\r\n                    <v-row>\r\n                      <v-col md=\"12\">\r\n                        <v-text-field\r\n                            label=\"商品名\"\r\n                            :rules=\"formEmptyRule\"\r\n                            v-model=\"productForm.product_name\"\r\n                            clearable\r\n                        />\r\n                      </v-col>\r\n                    </v-row>\r\n                    <v-row>\r\n                      <v-col md=\"12\">\r\n                        <v-text-field\r\n                            label=\"商品品牌\"\r\n                            :rules=\"formEmptyRule\"\r\n                            v-model=\"productForm.product_brand\"\r\n                            clearable\r\n                        />\r\n                      </v-col>\r\n                    </v-row>\r\n                    <v-row>\r\n                      <v-col md=\"12\">\r\n                        <v-text-field\r\n                            label=\"商品颜色\"\r\n                            :rules=\"formEmptyRule\"\r\n                            v-model=\"productForm.product_color\"\r\n                            clearable\r\n                        />\r\n                      </v-col>\r\n                    </v-row>\r\n\r\n                    <v-row>\r\n                      <v-col md=\"12\">\r\n                        <v-text-field\r\n                            label=\"商品售价\"\r\n                            :rules=\"costRule\"\r\n                            v-model=\"productForm.product_cost\"\r\n                            clearable\r\n                        />\r\n                      </v-col>\r\n                    </v-row>\r\n                    <!--\r\n                    <v-row>\r\n                      <v-col md=\"12\">\r\n                        <v-text-field\r\n                            label=\"商品库存\"\r\n                            :rules=\"formEmptyRule\"\r\n                            clearable\r\n                        />\r\n                      </v-col>\r\n                    </v-row>\r\n                    !-->\r\n                  </v-container>\r\n                </v-form>\r\n              </v-col>\r\n              <v-col md=\"6\">\r\n                <el-form ref=\"form\" :model=\"productForm\" label-width=\"80px\">\r\n                  <el-form-item label=\"主页图片\">\r\n                    <input type=\"file\" @change=\"getImageFile1\" id=\"img\">\r\n                    <img :src=\"showPic1\" height=\"150px\" width=\"150px\"/>\r\n                  </el-form-item>\r\n\r\n                </el-form>\r\n                <el-form ref=\"form\" :model=\"productForm\" label-width=\"80px\">\r\n                  <el-form-item label=\"细节图片\">\r\n                    <input type=\"file\" @change=\"getImageFile2\" id=\"img\">\r\n                    <img :src=\"showPic2\" height=\"150px\" width=\"150px\"/>\r\n                  </el-form-item>\r\n\r\n                </el-form>\r\n              </v-col>\r\n            </v-row>\r\n            <v-divider/>\r\n            <v-row justify=\"end\">\r\n              <v-col md=\"4\" align=\"end\">\r\n                <v-btn\r\n                    small\r\n                    tile\r\n                    class=\"mr-2\"\r\n                    color=\"primary\"\r\n                    @click=\"saveProduct\"\r\n                >\r\n                  添加\r\n                </v-btn>\r\n              </v-col>\r\n            </v-row>\r\n          </v-card>\r\n        </v-card>\r\n      </v-col>\r\n    </v-row>\r\n  </div>\r\n</template>\r\n\r\n\r\n<script>\r\nimport {required} from \"@/utils/widget\";\r\n\r\nexport default {\r\n  name: \"business_add_commodity\",\r\n  data() {\r\n    return {\r\n      id: parseInt(this.$route.params.id),\r\n\r\n      productForm: {\r\n        product_name: \"\", // 商品名\r\n        product_color: \"\", // 商品颜色\r\n        // TODO：商品进价/商品售价\r\n        product_brand: \"\", // 商品库存\r\n        product_cost: \"\", // 商品库存\r\n        product_image1: \"\", // 主页图片\r\n        product_image2: \"\"\r\n        // TODO：细节图片\r\n      },\r\n      showPic1:\"\",\r\n      showPic2:\"\",\r\n      formEmptyRule: [required(\"此栏目\")],\r\n      costRule:[required(\"此栏目\"),\r\n          function (v) {\r\n            return  /^(([1-9]{1}\\d*)|(0{1}))(\\.\\d{1,2})?$/.test(v) || `金额最多两位小数`;\r\n          }\r\n      ]\r\n\r\n    };\r\n  },\r\n  async created() {\r\n    await this.fetchInfoToForm()\r\n  },\r\n\r\n\r\n\r\n  methods: {\r\n    async fetchInfoToForm(){\r\n      await this.axios.get('fetch_product/',{params:{product_id: this.id}})\r\n        .then((response) => {\r\n            console.log(response);\r\n            this.productForm={\r\n        product_name: response.data.product.fields.product_name, // 商品名\r\n        product_color: response.data.product.fields.product_color, // 商品颜色\r\n\r\n        product_brand: response.data.product.fields.product_brand, // 商品库存\r\n        product_cost: response.data.product.fields.product_cost, // 商品库存\r\n        product_image1: null, // 主页图片\r\n        product_image2: null\r\n\r\n      };\r\n            this.showPic2='http://127.0.0.1:8000/media/'+response.data.product.fields.product_imageDetail;\r\n          this.showPic1='http://127.0.0.1:8000/media/'+response.data.product.fields.product_image;\r\n\r\n        })\r\n        .catch(function (error) {\r\n            console.log(error);\r\n\r\n        });\r\n    },\r\n    // TODO：保存商品信息\r\n    async saveProduct() {\r\n      let formData = new FormData();\r\n        formData.append('product_image1', this.productForm.product_image1);\r\n        formData.append('product_image2', this.productForm.product_image2);\r\n\r\n        const json = JSON.stringify(this.productForm);\r\n        const blob = new Blob([json], {\r\n          type: 'application/json'\r\n        });\r\n\r\n        formData.append('forms',blob)\r\n\r\n        const json2 = JSON.stringify((this.$store.state.userId));\r\n        const blob2 = new Blob([json2], {\r\n          type: 'application/json'\r\n        });\r\n\r\n        formData.append('user_id',blob2)\r\n\r\n      const json3 = JSON.stringify((this.id));\r\n        const blob3 = new Blob([json3], {\r\n          type: 'application/json'\r\n        });\r\n\r\n        formData.append('product_id',blob3)\r\n\r\n\r\n        console.log(\"blob2\")\r\n        console.log(blob2)\r\n        console.log(JSON.stringify((this.$store.state.user_id)))\r\n\r\n        var configs = {\r\n          headers:{'Content-Type':'multipart/form-data'}\r\n        }\r\n\r\n        await this.axios.post('edit_product/',formData, configs).then(response => {\r\n          console.log(formData.get('forms'))\r\n        if(response.data.msg===\"success\"){\r\n          //this.showPic1 = 'http://127.0.0.1:8000/media/'+response.data.image1\r\n          //this.showPic2 = 'http://127.0.0.1:8000/media/'+response.data.image2\r\n          console.log(response)\r\n\r\n\r\n\r\n\r\n\r\n          window.alert(\"商品修改申请已成功提交，请耐心等待审核通过\")\r\n          this.$router.push({path: '/business/commodity'})\r\n\r\n\r\n          }\r\n        console.log(response)\r\n        })\r\n        .catch(function (error) {\r\n            console.log(error);\r\n        });\r\n\r\n    },\r\n    getImageFile1:function(e) {\r\n       this.productForm.product_image1 = e.target.files[0];\r\n      let img = new FileReader();\r\n      img.readAsDataURL(this.productForm.product_image1);\r\n      console.log(\"img:\",img)\r\n      img.onload = ({ target }) => {\r\n        this.showPic1 = target.result; //将img转化为二进制数据\r\n        console.log(\"target:\",target)\r\n      };\r\n    },\r\n    getImageFile2:function(e) {\r\n       this.productForm.product_image2 = e.target.files[0];\r\n      let img = new FileReader();\r\n      img.readAsDataURL(this.productForm.product_image2);\r\n      console.log(\"img:\",img)\r\n      img.onload = ({ target }) => {\r\n        this.showPic2 = target.result; //将img转化为二进制数据\r\n        console.log(\"target:\",target)\r\n      };\r\n    },\r\n    async onSubmit(){\r\n      console.log(\"good\");\r\n    },\r\n    clear(){\r\n      this.productForm={\r\n        product_name: \"\", // 商品名\r\n        product_color: \"\", // 商品颜色\r\n        // TODO：商品进价/商品售价\r\n        product_brand: \"\", // 商品库存\r\n        product_cost: \"\", // 商品库存\r\n        product_image1: \"\", // 主页图片\r\n        product_image2: \"\"\r\n        // TODO：细节图片\r\n      },\r\n      this.showPic1=\"\",\r\n      this.showPic2=\"\"\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style>\r\n\r\n</style>\r\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}